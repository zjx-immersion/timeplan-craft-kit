# 连线路径优化完成

## 优化内容

### 1. **提高SVG层级**
```typescript
// 修改前
zIndex: 1,

// 修改后
zIndex: 10,  // ✅ 确保在line之上
```

**效果**: 连线不会被不透明的line矩形覆盖

---

### 2. **使用贝塞尔曲线路径**

#### 同行连线（起点和终点在同一Timeline）

**修改前**（直线）:
```
M startX startY → L endX endY
```

**修改后**（上方绕过的贝塞尔曲线）:
```
M startX startY
C ... (向上弯曲)
L ... (水平经过bar上方)
C ... (向下回到终点)
→ endX endY
```

**效果示意**:
```
起点 ●─────╭───────╮─────● 终点
          │  Bar  │
          ╰───────╯
          ↑ 从上方绕过
```

---

#### 跨行连线（起点和终点在不同Timeline）

**修改前**（三段式直线）:
```
M startX startY
L midX startY     ← 水平
L midX endY       ← 垂直（穿过bars）
L endX endY       ← 水平
```

**修改后**（S型贝塞尔曲线）:
```
M startX startY
C ... (平滑向右)
  midX (startY + endY) / 2  ← 中间点
C ... (平滑向右下)
→ endX endY
```

**效果示意**:
```
Timeline 1:  起点 ●─────╮
                      ╲ S型曲线
Timeline 2:  Bar1     ╲ (避开bars)
                       ╲
Timeline 3:  Bar2       ╲
                         ╲─────● 终点
```

---

### 3. **路径算法参数**

| 参数 | 值 | 说明 |
|------|---|------|
| `curveOffset` | 30-80px | 贝塞尔曲线控制点偏移量 |
| `VERTICAL_OFFSET` | 24px (40% row height) | 同行绕过时的垂直偏移 |
| `ROW_HEIGHT` | 60px | Timeline行高 |

---

## 测试验证

### 场景1: 同行连线（如截图中蓝色bar的连线）
- ✅ 连线从上方绕过bar
- ✅ 使用平滑的贝塞尔曲线
- ✅ 不被bar遮挡

### 场景2: 跨行连线（如紫色到红色的连线）
- ✅ 使用S型曲线
- ✅ 平滑过渡，不穿过中间的bars
- ✅ 视觉效果更优雅

### 场景3: 回绕连线（目标在左侧）
- ✅ 从右侧绕出
- ✅ 经过中间区域
- ✅ 绕回左侧终点

---

## 视觉对比

### 优化前
```
起点 ●──────────────────● 终点
     ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
     (连线被bar覆盖，看不清)
```

### 优化后
```
起点 ●─────╭───────╮─────● 终点
          │  Bar  │
          ╰───────╯
          (连线从上方绕过，清晰可见)
```

---

## 代码改动摘要

1. **SVG层级**: `zIndex: 1` → `zIndex: 10`
2. **路径算法**: 完全重写`calculatePath`函数
   - 同行：上方绕过的贝塞尔曲线
   - 跨行：S型贝塞尔曲线
   - 回绕：复杂曲线路径

---

## 预期效果

### 同行连线（水平）
```svg
<!-- 从上方绕过bar -->
<path d="M 100 50 C 130 50, 130 30, 160 30 L 240 30 C 270 30, 270 50, 300 50" />
```

### 跨行连线（S型）
```svg
<!-- 平滑的S型曲线 -->
<path d="M 100 50 C 150 50, 200 50, 250 150 C 300 250, 350 300, 400 300" />
```

---

## 刷新测试

请刷新页面后验证：

1. ✅ 连线是否清晰可见（不被bar遮挡）
2. ✅ 同行连线是否从上方绕过bar
3. ✅ 跨行连线是否使用平滑的S型曲线
4. ✅ 连线路径是否优雅、不穿过bar

如果还有问题，可以调整：
- `VERTICAL_OFFSET`: 绕过高度（当前24px）
- `curveOffset`: 曲线控制点偏移（当前30-80px）
- `zIndex`: SVG层级（当前10）
