# 矩阵V3 - 单元格内容增强设计方案

**日期**: 2026-02-12  
**版本**: v3.1.0  
**状态**: 设计中  

---

## 设计目标

增强矩阵V3的单元格显示内容和交互功能，提升信息密度和用户体验。

---

## 增强功能列表

### 1. 单元格内容增强

#### 1.1 优先级分布指示器

在单元格底部添加优先级分布指示条：

```
┌─────────────────┐
│                 │
│   45人天        │  ← 总工作量
│   5个任务       │  ← 任务数量
│                 │
│ ▓▓░░▓░░▓        │  ← 优先级分布条
│ P0 P1 P2 P3     │
└─────────────────┘
```

**优先级图标映射**:
- P0 (最高): 🔴 红色
- P1 (高): 🟠 橙色  
- P2 (中): 🔵 蓝色
- P3 (低): 🟢 绿色

#### 1.2 单元格布局优化

```
┌─────────────────────────┐
│ 📊 45人天               │  ← 右上角：总工作量
│ 📋 5个任务              │  ← 右上角：任务数量
│                         │
│ [  热力图背景色  ]       │
│                         │
│ 🔴2 🟠1 🔵1 🟢1        │  ← 底部：优先级数量
└─────────────────────────┘
```

### 2. 单元格点击详情对话框

#### 2.1 对话框布局

```
┌──────────────────────────────────────────────────────────────┐
│ 📊 项目管理 - PTR 项目技术要求                    [× 关闭]    │
├──────────────────────────────────────────────────────────────┤
│ 统计概览:                                                    │
│ ┌──────────────┬──────────────┬──────────────┬─────────────┐ │
│ │  总工作量    │   任务数     │   平均进度   │   负载率    │ │
│ │  45人天      │   5个        │   60%        │   75% 🟡   │ │
│ └──────────────┴──────────────┴──────────────┴─────────────┘ │
│                                                              │
│ 优先级分布:                                                  │
│ 🔴 P0: 2个任务 (18人天)   ████████████░░░░░░░░░░ 80%       │
│ 🟠 P1: 1个任务 (15人天)   ███████░░░░░░░░░░░░░░░ 60%       │
│ 🔵 P2: 1个任务 (6人天)    ███░░░░░░░░░░░░░░░░░░░ 30%       │
│ 🟢 P3: 1个任务 (6人天)    ███░░░░░░░░░░░░░░░░░░░ 0%        │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ 任务列表:                                                    │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 🔴 P0  需求分析                        [在甘特图查看]  │  │
│ │      负责人: 张三  |  10人天  |  2026-01-15~01-25      │  │
│ │      进度: ████████████░░░░░░░░░░░░░░░ 80%            │  │
│ ├────────────────────────────────────────────────────────┤  │
│ │ 🔴 P0  架构设计                        [在甘特图查看]  │  │
│ │      负责人: 李四  |  8人天   |  2026-01-20~01-28      │  │
│ │      进度: ███████░░░░░░░░░░░░░░░░░░░░ 60%            │  │
│ ├────────────────────────────────────────────────────────┤  │
│ │ 🟠 P1  核心功能开发                    [在甘特图查看]  │  │
│ │      负责人: 王五  |  15人天  |  2026-01-25~02-10      │  │
│ │      进度: █████░░░░░░░░░░░░░░░░░░░░░░ 30%            │  │
│ ├────────────────────────────────────────────────────────┤  │
│ │ 🔵 P2  单元测试                        [在甘特图查看]  │  │
│ │      负责人: 赵六  |  6人天   |  2026-02-01~02-07      │  │
│ │      进度: ░░░░░░░░░░░░░░░░░░░░░░░░░░░ 0%             │  │
│ ├────────────────────────────────────────────────────────┤  │
│ │ 🟢 P3  文档编写                        [在甘特图查看]  │  │
│ │      负责人: 张三  |  6人天   |  2026-02-05~02-12      │  │
│ │      进度: ░░░░░░░░░░░░░░░░░░░░░░░░░░░ 0%             │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ [导出Excel]                              [在甘特图中查看]    │
└──────────────────────────────────────────────────────────────┘
```

#### 2.2 任务列表项组件

```typescript
interface TaskListItemProps {
  line: Line;
  priority: 'P0' | 'P1' | 'P2' | 'P3';
  onViewInGantt: (lineId: string) => void;
}
```

### 3. 数据模型增强

#### 3.1 扩展 MatrixCellV3

```typescript
interface MatrixCellV3 {
  // ... 现有字段
  
  // 新增：优先级分布
  priorityDistribution: {
    P0: number;  // P0任务数量
    P1: number;  // P1任务数量
    P2: number;  // P2任务数量
    P3: number;  // P3任务数量
  };
  
  // 新增：按优先级的工作量分布
  effortByPriority: {
    P0: number;
    P1: number;
    P2: number;
    P3: number;
  };
  
  // 新增：任务列表（已存在，但需扩展详情）
  lines: LineExtended[];
}
```

#### 3.2 扩展 Line 类型

```typescript
interface LineExtended extends Line {
  // 扩展属性
  priority?: 'P0' | 'P1' | 'P2' | 'P3';
  owner?: string;
  progress?: number;
  effort?: number;
}
```

### 4. 组件设计

#### 4.1 MatrixCellContent - 单元格内容组件

```typescript
interface MatrixCellContentProps {
  cell: MatrixCellV3;
  onClick: () => void;
  size: 'small' | 'medium' | 'large';
}
```

**显示模式**:
- `small`: 仅显示热力图颜色 + 悬浮Tooltip
- `medium`: 显示工作量 + 任务数（当前默认）
- `large`: 完整信息（工作量 + 任务数 + 优先级分布）

#### 4.2 CellDetailDialog - 单元格详情对话框

```typescript
interface CellDetailDialogProps {
  open: boolean;
  onClose: () => void;
  cell: MatrixCellV3 | null;
  timelineName: string;
  timeNodeName: string;
  onViewInGantt?: (lineId: string) => void;
}
```

### 5. 实施计划

| 优先级 | 功能 | 工作量 | 文件 |
|--------|------|--------|------|
| P0 | 单元格优先级分布显示 | 1天 | MatrixTableV3.tsx |
| P0 | 详情对话框基础版 | 1天 | CellDetailDialog.tsx |
| P1 | 任务列表项组件 | 0.5天 | TaskListItem.tsx |
| P1 | 数据统计卡片 | 0.5天 | CellStatistics.tsx |
| P2 | 导出功能 | 0.5天 | exportUtils.ts |
| P2 | 单元格显示模式切换 | 0.5天 | MatrixViewV3.tsx |

---

## UI/UX 规范

### 颜色规范

```typescript
const PRIORITY_COLORS = {
  P0: { bg: '#ff4d4f', text: '#fff', label: '最高' },
  P1: { bg: '#fa8c16', text: '#fff', label: '高' },
  P2: { bg: '#1890ff', text: '#fff', label: '中' },
  P3: { bg: '#52c41a', text: '#fff', label: '低' },
};
```

### 尺寸规范

- 单元格最小高度: 60px
- 优先级指示器高度: 4px
- 对话框最小宽度: 700px
- 任务列表最大高度: 400px（超出滚动）

### 交互规范

1. **单元格悬浮**: 显示Tooltip（当前已实现）
2. **单元格点击**: 打开详情对话框
3. **任务项悬浮**: 显示操作按钮（在甘特图查看）
4. **对话框关闭**: 点击遮罩或X按钮

---

## 验收标准

- [ ] 单元格显示优先级分布指示器
- [ ] 点击单元格打开详情对话框
- [ ] 对话框显示任务列表及详细信息
- [ ] 支持跳转到甘特图查看任务
- [ ] 响应式布局适配不同屏幕
- [ ] 性能无明显下降（< 100ms渲染延迟）
