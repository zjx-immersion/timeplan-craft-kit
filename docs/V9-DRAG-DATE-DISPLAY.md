# V9 拖拽日期显示增强

## 📋 需求描述

**用户反馈**：拖动line时，需要显示起始和终止日期的变化，不能仅显示起始日期。

### 当前问题

拖拽时只显示起始日期：
```
移动中
2026-02-01
```

应该显示起始和终止日期：
```
移动中
2026-02-01 ~ 2026-02-08
```

## 🔍 问题分析

### 原代码位置

**文件**: `timeplan-craft-kit/src/components/timeline/TimelinePanel.tsx`

```typescript:2310:2315:timeplan-craft-kit/src/components/timeline/TimelinePanel.tsx
<div style={{ fontSize: 11, opacity: 0.9 }}>
  {isDragActive
    ? `${format(dragSnappedDates.start!, 'yyyy-MM-dd')}`  // ❌ 只显示起始日期
    : `${format(resizeSnappedDates.start!, 'yyyy-MM-dd')} ~ ${format(resizeSnappedDates.end!, 'yyyy-MM-dd')}`
  }
</div>
```

### 问题分析

1. **拖拽模式** (`isDragActive=true`)
   - ❌ 只显示 `dragSnappedDates.start`
   - ❌ 用户无法看到终止日期的变化

2. **调整大小模式** (`isDragActive=false`)
   - ✅ 同时显示 `resizeSnappedDates.start ~ resizeSnappedDates.end`
   - ✅ 用户可以看到完整的日期范围

### 不一致性

- 调整大小时：显示完整日期范围
- 拖拽移动时：只显示起始日期
- **不一致！** 应该统一显示完整日期范围

## ✅ V9 修复方案

### 修改内容

**文件**: `timeplan-craft-kit/src/components/timeline/TimelinePanel.tsx`

```typescript
<div style={{ fontSize: 11, opacity: 0.9 }}>
  {isDragActive
    ? `${format(dragSnappedDates.start!, 'yyyy-MM-dd')} ~ ${format(dragSnappedDates.end!, 'yyyy-MM-dd')}`  // ✅ 显示起始和终止日期
    : `${format(resizeSnappedDates.start!, 'yyyy-MM-dd')} ~ ${format(resizeSnappedDates.end!, 'yyyy-MM-dd')}`
  }
</div>
```

### 修复原理

`dragSnappedDates` 对象包含：
- `start`: 拖拽后的起始日期
- `end`: 拖拽后的终止日期

拖拽移动是**整体移动**，起始和终止日期同时改变：
- 原始：`2026-02-01 ~ 2026-02-08` (8天)
- 向右拖3天：`2026-02-04 ~ 2026-02-11` (仍然8天)

**用户需要看到完整的日期范围变化**。

## 📊 修复前后对比

### 修复前 (V8)

**拖拽时**：
```
┌─────────────┐
│   移动中    │
│ 2026-02-01  │  ❌ 只有起始日期
└─────────────┘
```

**调整大小时**：
```
┌──────────────────────────────┐
│         调整中               │
│ 2026-02-01 ~ 2026-02-08     │  ✅ 有完整范围
└──────────────────────────────┘
```

### 修复后 (V9)

**拖拽时**：
```
┌──────────────────────────────┐
│         移动中               │
│ 2026-02-01 ~ 2026-02-08     │  ✅ 显示完整范围
└──────────────────────────────┘
```

**调整大小时**：
```
┌──────────────────────────────┐
│         调整中               │
│ 2026-02-01 ~ 2026-02-08     │  ✅ 显示完整范围
└──────────────────────────────┘
```

**统一！两种模式都显示完整日期范围。**

## 🎯 用户体验改进

### 拖拽场景示例

**场景1: 向右拖3天**
```
原始：2026-02-01 ~ 2026-02-08
↓ 拖拽中
提示：2026-02-04 ~ 2026-02-11
↓ 释放
结果：2026-02-04 ~ 2026-02-11
```

**场景2: 向左拖2天**
```
原始：2026-02-15 ~ 2026-02-20
↓ 拖拽中
提示：2026-02-13 ~ 2026-02-18
↓ 释放
结果：2026-02-13 ~ 2026-02-18
```

### 信息完整性

✅ **起始日期**：用户知道Line的开始位置
✅ **终止日期**：用户知道Line的结束位置
✅ **持续时间**：用户可以直接看到时间跨度
✅ **对齐检查**：用户可以精确对齐到目标日期

## 📝 关键修改总结

| 文件 | 修改位置 | 修改内容 |
|------|---------|---------|
| `TimelinePanel.tsx` | 第2312行 | 添加终止日期显示 |

**修改行数**: 1行  
**影响范围**: 拖拽提示UI  
**向下兼容**: ✅ 完全兼容

## 🧪 测试验证

### 手工测试

1. **进入编辑模式**
2. **选中任意Bar**
3. **拖拽Bar**
4. **观察屏幕右下角的提示框**
   - ✅ 应该显示：`移动中` + `起始日期 ~ 终止日期`
5. **释放Bar**
6. **调整Bar大小**
7. **观察提示框**
   - ✅ 应该显示：`调整中` + `起始日期 ~ 终止日期`

### 预期结果

**拖拽和调整大小的提示框格式一致**：
```
[标题]
起始日期 ~ 终止日期
```

---

**修复时间**: 2026-02-08  
**修复版本**: V9  
**关联**: V8 Bar边界对齐修复
