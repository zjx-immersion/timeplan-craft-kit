# 模块规划视图使用指南

## 概述

模块规划视图是一个全新的视图，专门用于按团队模块组织和展示MR（Merge Request）拆解，支持可视化显示依赖关系。

## 功能特点

### 1. 分组结构

```
📦 产品线（可折叠）
├── 📦 模块1
│   ├── MR 1.1 → MR 1.2
│   ├── MR 1.2 → MR 1.3
│   └── MR 1.3
├── 📦 模块2
│   ├── MR 2.1
│   └── MR 2.2
└── ...
```

### 2. MR卡片信息

每个MR卡片显示：
- **类型图标**: 计划单元/里程碑/关口
- **MR名称**: 如"E0.1 域控架构方案设计"
- **类型标签**: 蓝色/绿色/橙色标签
- **依赖关系**: 显示依赖的其他MR
- **负责人**: 👤 图标 + 姓名
- **日期范围**: 📅 开始日期 ~ 结束日期
- **时长**: 紫色标签显示天数
- **进度条**: 完成百分比（如果有）

### 3. 依赖关系可视化

- **箭头图标**: 卡片右上角显示 → 表示有后续MR
- **依赖标签**: 卡片中显示"依赖: XXX"
- **连线展示**: 使用蓝色标签列出所有前置依赖

## 如何使用

### 步骤1: 打开OrionX计划
1. 访问 http://localhost:9082
2. 选择 **"Orion X 智能驾驶平台 2026 年度计划（完整版）"**

### 步骤2: 切换到模块规划视图
1. 点击工具栏的 **"模块规划"** 按钮
2. 图标: `NodeIndexOutlined`（节点图标）
3. 位置: 在"时间迭代"按钮右侧

### 步骤3: 浏览模块
1. **折叠/展开产品线**: 点击产品线标题
2. **查看模块**: 每个产品线下显示所有模块
3. **浏览MR**: 每个模块下按时间顺序列出MR

### 步骤4: 交互操作
- **点击MR卡片**: 查看详情（目前显示消息提示）
- **悬停查看**: 查看完整的依赖关系列表
- **滚动浏览**: 支持上下滚动查看所有模块

## 数据要求

### 必需属性

MR数据必须包含以下属性：

```typescript
{
  id: 'line-ee-001-mr1',
  timelineId: 'tl-ee-arch',
  label: 'E0.1 域控架构方案设计',
  schemaId: 'lineplan-schema',
  startDate: '2026-01-15',
  endDate: '2026-01-31',
  attributes: {
    module: 'E0架构',          // ✅ 必需：模块名
    productLine: '电子架构',    // ✅ 必需：产品线
    owner: '架构师A',           // 可选：负责人
    progress: 0,                // 可选：进度
  }
}
```

### 依赖关系

依赖关系在`relations`数组中定义：

```typescript
{
  id: 'rel-ee-mr-001',
  type: 'dependency',
  fromLineId: 'line-ee-001',     // 前置MR
  toLineId: 'line-ee-001-mr2',   // 后续MR
  properties: {
    dependencyType: 'finish-to-start',
    lag: 1,
  }
}
```

## 示例数据

OrionX v4数据包含完整的模块规划示例：

### 产品线1：电子架构
- **模块**: E0架构
  - E0.1 域控架构方案设计
  - E0.2 传感器配置方案
  - E0.3 系统通信架构

### 产品线2：感知算法
- **模块**: 视觉感知
  - P1.1 图像预处理模块
  - P1.2 目标检测算法
  - P1.3 多帧跟踪融合
  - P1.4 环境语义理解

### 产品线3：规划决策
- **模块**: 行为决策
  - PL1.1 决策状态机设计
  - PL1.2 强化学习策略
  - PL1.3 决策评估验证
- **模块**: 路径规划
  - PL2.1 全局路径规划
  - PL2.2 局部路径规划

## 视图对比

| 功能 | 时间迭代视图 | 模块规划视图 |
|------|------------|------------|
| 分组方式 | 按时间范围（14天） | 按产品线+模块 |
| 显示内容 | 时间段内所有任务 | 模块下的MR拆解 |
| 依赖关系 | 不显示 | ✅ 显示 |
| 适用场景 | Sprint规划 | 模块化开发 |
| 数据要求 | 时间范围 | module + productLine |

## 常见问题

### Q: 为什么看不到数据？
A: 检查以下条件：
1. 确保查看的是OrionX计划（包含v4数据）
2. 数据中包含`module`和`productLine`属性
3. 刷新浏览器（Cmd+Shift+R）

### Q: 如何添加更多模块？
A: 在Line数据的`attributes`中添加：
```typescript
attributes: {
  module: '新模块名称',
  productLine: '所属产品线',
  // ... 其他属性
}
```

### Q: 依赖关系不显示？
A: 确认：
1. `relations`数组中有对应的依赖关系定义
2. `fromLineId`和`toLineId`正确关联
3. 依赖的MR在同一个或其他模块中存在

### Q: 如何自定义卡片样式？
A: 目前使用Ant Design Card组件，后续版本将支持自定义主题。

## 下一步计划

- [ ] 添加拖拽调整MR顺序
- [ ] 支持批量编辑MR
- [ ] 导出模块规划数据
- [ ] 依赖关系图谱可视化（类似网络图）
- [ ] 支持筛选和搜索功能

## 相关文档

- `docs/ITERATION-VIEW-DESIGN.md` - 设计说明
- `docs/V11.3-USER-GUIDE.md` - V11.3用户指南
- `src/components/views/ModuleIterationView.tsx` - 组件源码

---

**版本**: V11.4  
**更新日期**: 2026-02-08  
**状态**: ✅ 已实现并测试
