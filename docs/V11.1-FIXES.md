# V11.1 ä¿®å¤è®°å½•

> **æ—¥æœŸ**: 2026-02-08  
> **åŸºç¡€ç‰ˆæœ¬**: v0.1.1-rc (commit bb38997)  
> **ä¿®å¤ç›®çš„**: è§£å†³å›é€€åé—ç•™çš„åˆ é™¤åŠŸèƒ½å¤±è´¥å’ŒçŸ©é˜µè§†å›¾æ— æ•°æ®é—®é¢˜

---

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

å›é€€åˆ° v0.1.1-rc ç‰ˆæœ¬åï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

### âœ… å·²è§£å†³çš„é—®é¢˜
1. **Headerå’Œå·¥å…·æ é‡å¤** - å›é€€åè‡ªåŠ¨è§£å†³
2. **ç”˜ç‰¹å›¾æ•°æ®æœªæ¸²æŸ“** - å›é€€åè‡ªåŠ¨è§£å†³

### âš ï¸ é—ç•™é—®é¢˜ï¼ˆæœ¬æ¬¡ä¿®å¤ï¼‰
3. **åˆ é™¤åŠŸèƒ½å¤±è´¥** - åˆ é™¤line/gateway/milestoneæ—¶æ— å“åº”
4. **çŸ©é˜µè§†å›¾æ— æ•°æ®** - çŸ©é˜µè§†å›¾æ˜¾ç¤ºç©ºç™½

---

## ğŸ”§ ä¿®å¤è¯¦æƒ…

### ä¿®å¤1: åˆ é™¤åŠŸèƒ½ï¼ˆReact 19 å…¼å®¹æ€§ï¼‰

#### é—®é¢˜åŸå› 
åœ¨ React 19 ä¸­ï¼Œ`Modal.confirm` é™æ€æ–¹æ³•æ— æ³•æ­£ç¡®è®¿é—® App çš„ contextï¼Œå¯¼è‡´ç¡®è®¤å¯¹è¯æ¡†æ— æ³•æ˜¾ç¤ºã€‚

#### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ `App.useApp()` è·å– modal å®ä¾‹ï¼Œæ”¹ç”¨ `modal.confirm()`ã€‚

#### ä¿®å¤çš„å‡½æ•°

1. **`handleDeleteNode`** (ç¬¬1161-1200è¡Œ)
   - åˆ é™¤èŠ‚ç‚¹ï¼ˆlineï¼‰
   - åŒæ—¶æ¸…ç†ç›¸å…³çš„relationså’ŒåµŒå¥—çš„å­èŠ‚ç‚¹
   
2. **`handleRelationDelete`** (ç¬¬868-886è¡Œ)
   - åˆ é™¤ä¾èµ–è¿çº¿
   - æ¸…é™¤é€‰ä¸­çŠ¶æ€
   
3. **`handleDeleteBaseline`** (ç¬¬1006-1024è¡Œ)
   - åˆ é™¤åŸºçº¿
   - åŒæ—¶åˆ é™¤ç›¸å…³çš„baselineRanges
   
4. **`handleDeleteBaselineRange`** (ç¬¬1087-1103è¡Œ)
   - åˆ é™¤åŸºçº¿æ—¶é—´èŒƒå›´

#### ä»£ç å˜æ›´

**1. æ·»åŠ  modal å®ä¾‹å£°æ˜** (ç¬¬143è¡Œ)
```typescript
/**
 * âœ… V11.1ä¿®å¤ï¼šä½¿ç”¨App.useApp()è·å–modalå®ä¾‹ï¼ˆé¿å…contexté—®é¢˜ï¼‰
 */
const { modal } = App.useApp();
```

**2. ä¿®æ”¹å‡½æ•°å®ç°**
```diff
- Modal.confirm({
+ modal.confirm({
    title: 'åˆ é™¤èŠ‚ç‚¹',
    content: `ç¡®å®šè¦åˆ é™¤èŠ‚ç‚¹"${node.label}"å—ï¼Ÿæ­¤æ“ä½œå¯ä»¥é€šè¿‡æ’¤é”€æ¢å¤ã€‚`,
    okText: 'åˆ é™¤',
    okType: 'danger',
    cancelText: 'å–æ¶ˆ',
    onOk: () => {
      // ...
    },
  });
- }, [data, setData]);
+ }, [data, setData, modal]);
```

#### å½±å“èŒƒå›´
- `src/components/timeline/TimelinePanel.tsx`
  - ç¬¬143-145è¡Œï¼šæ·»åŠ  modal å£°æ˜
  - ç¬¬869è¡Œï¼šhandleRelationDelete
  - ç¬¬886è¡Œï¼šä¾èµ–æ•°ç»„æ·»åŠ  modal
  - ç¬¬1007è¡Œï¼šhandleDeleteBaseline
  - ç¬¬1024è¡Œï¼šä¾èµ–æ•°ç»„æ·»åŠ  modal
  - ç¬¬1088è¡Œï¼šhandleDeleteBaselineRange
  - ç¬¬1103è¡Œï¼šä¾èµ–æ•°ç»„æ·»åŠ  modal
  - ç¬¬1170è¡Œï¼šhandleDeleteNode
  - ç¬¬1200è¡Œï¼šä¾èµ–æ•°ç»„æ·»åŠ  modal

---

### ä¿®å¤2: çŸ©é˜µè§†å›¾é‡æ„

#### é—®é¢˜åŸå› 
å½“å‰å®ç°ä½¿ç”¨"äº§å“çº¿ Ã— Timeline"çŸ©é˜µï¼Œä½†æ•°æ®ä¸­ç¼ºå°‘ `productLine` å±æ€§ï¼Œå¯¼è‡´çŸ©é˜µä¸ºç©ºã€‚

#### è§£å†³æ–¹æ¡ˆ
å‚è€ƒåŸé¡¹ç›® `timeline-craft-kit`ï¼Œæ”¹ä¸º **"Timeline Ã— æœˆä»½"** çŸ©é˜µå±•ç¤ºã€‚

#### è®¾è®¡å˜æ›´

**æ—§è®¾è®¡ï¼ˆäº§å“çº¿Ã—Timelineï¼‰**
```
| äº§å“çº¿   | Timeline1 | Timeline2 | Timeline3 |
|---------|-----------|-----------|-----------|
| äº§å“A   | 3ä¸ªä»»åŠ¡   | 2ä¸ªä»»åŠ¡   | 1ä¸ªä»»åŠ¡   |
| äº§å“B   | 1ä¸ªä»»åŠ¡   | 0ä¸ªä»»åŠ¡   | 2ä¸ªä»»åŠ¡   |
```

**æ–°è®¾è®¡ï¼ˆTimelineÃ—æœˆä»½ï¼‰**âœ…
```
| Timeline  | 2026å¹´1æœˆ | 2026å¹´2æœˆ | 2026å¹´3æœˆ |
|-----------|-----------|-----------|-----------|
| ç ”å‘å›¢é˜Ÿ1 | â–ªï¸é‡Œç¨‹ç¢‘A | â–ªï¸ä»»åŠ¡B   | â–ªï¸å…³å£C   |
|           | â–ªï¸ä»»åŠ¡D   |           |           |
| ç ”å‘å›¢é˜Ÿ2 | â–ªï¸ä»»åŠ¡E   | â–ªï¸é‡Œç¨‹ç¢‘F | -         |
```

#### æ ¸å¿ƒç®—æ³•

**1. æ—¥æœŸèŒƒå›´è®¡ç®—**
```typescript
// æ‰¾åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„æœ€å°å’Œæœ€å¤§æ—¥æœŸ
let minDate = new Date();
let maxDate = new Date();

lines.forEach(line => {
  if (line.startDate < minDate) minDate = line.startDate;
  const endDate = line.endDate || line.startDate;
  if (endDate > maxDate) maxDate = endDate;
});

// ç”Ÿæˆ12ä¸ªæœˆçš„åˆ—ï¼ˆä»minDateå¼€å§‹ï¼‰
const cols: Date[] = [];
let currentMonth = startOfMonth(minDate);
for (let i = 0; i < 12; i++) {
  cols.push(currentMonth);
  currentMonth = addMonths(currentMonth, 1);
}
```

**2. èŠ‚ç‚¹-æœˆä»½äº¤é›†åˆ¤æ–­**
```typescript
const nodesInMonth = lines.filter(line => {
  if (line.timelineId !== timeline.id) return false;
  
  const nodeStart = line.startDate;
  const nodeEnd = line.endDate || line.startDate;
  
  // èŠ‚ç‚¹ä¸æœˆä»½æœ‰äº¤é›†çš„3ç§æƒ…å†µï¼š
  // 1. èŠ‚ç‚¹å¼€å§‹æ—¥æœŸåœ¨æœˆä»½å†…
  // 2. èŠ‚ç‚¹ç»“æŸæ—¥æœŸåœ¨æœˆä»½å†…
  // 3. èŠ‚ç‚¹è·¨è¶Šæ•´ä¸ªæœˆä»½
  return isWithinInterval(nodeStart, { start: monthStart, end: monthEnd }) ||
         isWithinInterval(nodeEnd, { start: monthStart, end: monthEnd }) ||
         (nodeStart <= monthStart && nodeEnd >= monthEnd);
});
```

**3. èŠ‚ç‚¹ç±»å‹è¯†åˆ«**ï¼ˆåŸºäºschemaIdï¼‰
```typescript
const getTypeIcon = (schemaId: string) => {
  switch (schemaId) {
    case 'bar-schema': return <MinusOutlined />;
    case 'milestone-schema': return <FlagOutlined />;
    case 'gateway-schema': return <BgColorsOutlined />;
    default: return null;
  }
};
```

#### æ–°å¢åŠŸèƒ½

1. **èŠ‚ç‚¹ç±»å‹å¯è§†åŒ–**
   - ä»»åŠ¡ï¼ˆbar-schemaï¼‰ï¼šè“è‰² MinusOutlined å›¾æ ‡
   - é‡Œç¨‹ç¢‘ï¼ˆmilestone-schemaï¼‰ï¼šç»¿è‰² FlagOutlined å›¾æ ‡
   - å…³å£ï¼ˆgateway-schemaï¼‰ï¼šæ©™è‰² BgColorsOutlined å›¾æ ‡

2. **å“åº”å¼å¸ƒå±€**
   - è¡¨å¤´å›ºå®šï¼šTimelineåˆ—sticky left
   - åŒå‘æ»šåŠ¨ï¼šæ”¯æŒæ¨ªå‘å’Œçºµå‘æ»šåŠ¨
   - æœ€å°å®½åº¦ï¼š200pxï¼ˆTimelineåˆ—ï¼‰+ 150pxÃ—12ï¼ˆæœˆä»½åˆ—ï¼‰

3. **äº¤äº’å¢å¼º**
   - æ‚¬åœæç¤ºï¼šæ˜¾ç¤ºèŠ‚ç‚¹å®Œæ•´åç§°å’Œæ—¥æœŸèŒƒå›´
   - ç‚¹å‡»äº‹ä»¶ï¼š`onCellClick(timelineId, month)`
   - ç©ºå•å…ƒæ ¼ï¼šæ˜¾ç¤º"-"å ä½ç¬¦

#### å½±å“èŒƒå›´
- `src/components/views/MatrixView.tsx`ï¼ˆå®Œå…¨é‡å†™ï¼‰
  - å¯¼å…¥ï¼šæ·»åŠ  date-fns å‡½æ•°å’Œ Ant Design å›¾æ ‡
  - æ•°æ®ç»“æ„ï¼šæ”¹ä¸º `Record<string, Record<string, Line[]>>`
  - æ¸²æŸ“ï¼šä½¿ç”¨åŸç”Ÿ `<table>` æ›¿ä»£ Ant Design `<Table>`
  - æ ·å¼ï¼šä½¿ç”¨ theme.useToken() åŠ¨æ€æ ·å¼

---

## âœ… éªŒè¯ç»“æœ

### åˆ é™¤åŠŸèƒ½
- âœ… **åˆ é™¤èŠ‚ç‚¹**: é€‰ä¸­lineåæŒ‰Delete/Backspaceï¼Œæ˜¾ç¤ºç¡®è®¤æ¡†ï¼Œåˆ é™¤æˆåŠŸ
- âœ… **åˆ é™¤è¿çº¿**: å³é”®ç‚¹å‡»relationï¼Œé€‰æ‹©åˆ é™¤ï¼Œæ˜¾ç¤ºç¡®è®¤æ¡†ï¼Œåˆ é™¤æˆåŠŸ
- âœ… **åˆ é™¤åŸºçº¿**: åŸºçº¿æ ‡è®°å¤„å³é”®åˆ é™¤ï¼Œæ˜¾ç¤ºç¡®è®¤æ¡†ï¼Œåˆ é™¤æˆåŠŸ
- âœ… **åˆ é™¤åŸºçº¿èŒƒå›´**: åŸºçº¿èŒƒå›´å³é”®åˆ é™¤ï¼Œæ˜¾ç¤ºç¡®è®¤æ¡†ï¼Œåˆ é™¤æˆåŠŸ

### çŸ©é˜µè§†å›¾
- âœ… **æ•°æ®æ˜¾ç¤º**: æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰Timelineå’ŒèŠ‚ç‚¹
- âœ… **ç±»å‹å›¾æ ‡**: bar/milestone/gatewayå›¾æ ‡æ­£ç¡®æ˜¾ç¤º
- âœ… **æ—¥æœŸè®¡ç®—**: èŠ‚ç‚¹åœ¨æ­£ç¡®çš„æœˆä»½åˆ—ä¸­æ˜¾ç¤º
- âœ… **æ»šåŠ¨**: æ¨ªå‘å’Œçºµå‘æ»šåŠ¨æ­£å¸¸ï¼Œè¡¨å¤´å›ºå®š
- âœ… **äº¤äº’**: æ‚¬åœæç¤ºå’Œç‚¹å‡»äº‹ä»¶æ­£å¸¸

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¡Œæ•°å˜åŒ– |
|------|---------|---------|
| `TimelinePanel.tsx` | ä¿®æ”¹ | +5è¡Œ (æ·»åŠ modalå£°æ˜å’Œä¾èµ–) |
| `MatrixView.tsx` | é‡å†™ | ~300è¡Œ (å®Œå…¨é‡æ„) |

---

## ğŸ¯ æŠ€æœ¯è¦ç‚¹

### 1. React 19 å…¼å®¹æ€§
- âš ï¸ ä¸è¦ä½¿ç”¨ `Modal.confirm` ç­‰é™æ€æ–¹æ³•
- âœ… å§‹ç»ˆä½¿ç”¨ `App.useApp()` è·å–å®ä¾‹
- âœ… åœ¨ä¾èµ–æ•°ç»„ä¸­åŒ…å«å®ä¾‹å¼•ç”¨

### 2. date-fns æ—¥æœŸå¤„ç†
```typescript
import { 
  startOfMonth,     // è·å–æœˆåˆ
  endOfMonth,       // è·å–æœˆæœ«
  addMonths,        // æœˆä»½åŠ å‡
  isWithinInterval  // åˆ¤æ–­æ—¥æœŸæ˜¯å¦åœ¨åŒºé—´å†…
} from 'date-fns';
```

### 3. åŒºé—´äº¤é›†åˆ¤æ–­
```typescript
// AåŒºé—´: [nodeStart, nodeEnd]
// BåŒºé—´: [monthStart, monthEnd]
// äº¤é›†å­˜åœ¨çš„æ¡ä»¶ï¼ˆä¸‰é€‰ä¸€ï¼‰ï¼š
isWithinInterval(nodeStart, B) ||  // Açš„èµ·ç‚¹åœ¨Bå†…
isWithinInterval(nodeEnd, B) ||    // Açš„ç»ˆç‚¹åœ¨Bå†…
(nodeStart <= B.start && nodeEnd >= B.end)  // AåŒ…å«B
```

---

## ğŸ” å‚è€ƒèµ„æ–™

- **åŸé¡¹ç›®**: `/Users/jxzhong/workspace/voyah-devops-solution/bak-components/worked-version/timeline-craft-kit/src/components/timeline/MatrixView.tsx`
- **Ant Design Modalæ–‡æ¡£**: https://ant.design/components/modal-cn#API
- **date-fnsæ–‡æ¡£**: https://date-fns.org/docs/Getting-Started

---

## ğŸ“ åç»­å»ºè®®

### ä¼˜åŒ–æ–¹å‘
1. **çŸ©é˜µè§†å›¾æ€§èƒ½**
   - å½“èŠ‚ç‚¹æ•°é‡è¶…è¿‡100æ—¶ï¼Œè€ƒè™‘è™šæ‹Ÿæ»šåŠ¨
   - æœˆä»½æ•°é‡å¯é…ç½®ï¼ˆå½“å‰å›ºå®š12ä¸ªæœˆï¼‰

2. **åˆ é™¤åŠŸèƒ½å¢å¼º**
   - æ”¯æŒæ‰¹é‡åˆ é™¤ï¼ˆShift+é€‰æ‹©å¤šä¸ªèŠ‚ç‚¹ï¼‰
   - åˆ é™¤å‰é¢„è§ˆå½±å“èŒƒå›´

3. **çŸ©é˜µè§†å›¾æ‰©å±•**
   - æ”¯æŒæŒ‰å‘¨/å­£åº¦/å¹´å±•ç¤º
   - æ”¯æŒå¯¼å‡ºä¸ºExcel
   - æ”¯æŒå•å…ƒæ ¼ç¼–è¾‘ï¼ˆæ‹–æ‹½è°ƒæ•´æ—¥æœŸï¼‰

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-02-08 16:55  
**éªŒè¯çŠ¶æ€**: âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
